# 格式统计和 MCWorld 命名规则

## 📊 格式统计

### 总格式数：**37 种**

### 分类统计

#### Java 版格式（4种）
1. Schematic
2. SchemV1
3. SchemV2
4. Litematic

#### 基岩版格式（2种）
5. MCStructure
6. MCWorld

#### 第三方工具格式（8种）
7. BDX (PhoenixBuilder)
8. Construction (Amulet)
9. AxiomBP (Axiom)
10. MCFunction (BuildTool)
11. KBDX (万花筒)
12. IBImport (InfiniteBot)
13. TIBI (InfiniteBot)
14. CovStructure (Eggylan)

#### 国内工具格式（23种）

**绵羊系列（4种）**
15. MianYangV1
16. MianYangV2
17. MianYangV3 (V2压缩版)
18. MianYangV4 (V2二进制压缩版)

**钢板系列（7种）**
19. GangBanV1
20. GangBanV2
21. GangBanV3
22. GangBanV4
23. GangBanV5
24. GangBanV6
25. GangBanV7 (V6压缩版)

**其他国内工具（12种）**
26. RunAway (跑路)
27. QingXuV1 (情绪)
28. TimeBuilderV1
29. FuHongV1 (浮鸿)
30. FuHongV2
31. FuHongV3
32. FuHongV4
33. FuHongV5 (V4压缩加密版)
34. BDS (Consensus)
35. SIBI (虹欠)
36. BCF (bxy)
37. NexusNP (Nexus)

## 📝 MCWorld 命名规则

### 标准命名格式

```
{结构文件名}@[0,-64,0]~[{width-1},{height-64-1},{length-1}]
```

### 详细说明

**格式组成**：
- `{结构文件名}` - 去除扩展名后的文件名
- `@[0,-64,0]` - 起始坐标（固定）
  - X: 0
  - Y: -64（基岩版世界最低点）
  - Z: 0
- `~[{width-1},{height-64-1},{length-1}]` - 结束坐标（根据结构尺寸计算）
  - X: `width - 1`
  - Y: `height - 64 - 1`（因为起始Y是-64）
  - Z: `length - 1`

### 计算示例

假设结构文件 `castle.schematic`：
- Width: 100 方块
- Height: 50 方块
- Length: 80 方块

生成的世界名称：
```
castle@[0,-64,0]~[99,-15,79]
```

**计算过程**：
- 起始: `[0, -64, 0]`（固定）
- 结束 X: `100 - 1 = 99`
- 结束 Y: `50 - 64 - 1 = -15`
- 结束 Z: `80 - 1 = 79`

### 代码实现位置

**源码中的实现**：
```go
// building_operations.go (慢速/快速转换)
structureName := strings.TrimSuffix(filepath.Base(srcPath), filepath.Ext(srcPath))
worldName := fmt.Sprintf("%s@[0,-64,0]~[%d,%d,%d]",
    structureName,
    size.Width-1,
    size.Height-64-1,
    size.Length-1,
)
bedrockWorld.LevelDat().LevelName = worldName
```

**Termux脚本中的实现**：
- ✅ 已添加到 `convertStructure` 函数
- ✅ 当目标格式为 MCWorld 时，自动设置 LevelName

### 坐标解析

系统可以解析这种命名格式来提取坐标：

**正则表达式**：
```go
var selectionRegex = regexp.MustCompile(`@\[(-?\d+),(-?\d+),(-?\d+)\]~\[(-?\d+),(-?\d+),(-?\d+)\]`)
```

**解析示例**：
```
输入: "castle@[0,-64,0]~[99,-15,79]"
解析结果:
  起始坐标: (0, -64, 0)
  结束坐标: (99, -15, 79)
```

**用途**：
1. 从 MCWorld 文件名解析坐标
2. 从世界名称（LevelName）解析坐标
3. 优化导出路径（直接从 MCWorld 导出，无需重新解析）

### 导出任务的命名规则

在导出任务中（`export_task.go`），使用实际坐标：

```go
worldName := fmt.Sprintf("%s@[%d,%d,%d]~[%d,%d,%d]",
    filepath.Base(worldPath),
    e.StartPos.X(), e.StartPos.Y(), e.StartPos.Z(),
    e.EndPos.X(), e.EndPos.Y(), e.EndPos.Z(),
)
```

**区别**：
- **转换任务**: 固定起始坐标 `[0,-64,0]`，结束坐标根据结构尺寸计算
- **导出任务**: 使用实际的起始和结束坐标

## ✅ 验证清单

- [x] 格式总数：37 种
- [x] MCWorld 命名规则已实现
- [x] 坐标解析功能已实现
- [x] 优化路径支持坐标解析
- [x] Termux 脚本已添加 LevelName 设置

## 📌 总结

- **格式数量**: 37 种（Java版4 + 基岩版2 + 第三方8 + 国内工具23）
- **命名规则**: `{文件名}@[0,-64,0]~[{w-1},{h-65},{l-1}]`
- **坐标解析**: 支持从文件名和世界名称解析
- **优化功能**: 如果文件名包含坐标，可以直接从 MCWorld 导出
